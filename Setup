## Quellen:

## https://docs.voidlinux.org/installation/guides/fde.html
## https://gist.github.com/zen0bit/e246a35eec24756f9aba927f9a83fccc
## https://gist.github.com/gbrlsnchs/9c9dc55cd0beb26e141ee3ea59f26e21
## https://gitlab.com/BreakPointSSC/void-linux-uefi-luks-btrfs/-/blob/main/Void_Linux_Full_Disk_Encryption_KDE.txt
## https://gist.github.com/themagicalmammal/e443d3c5440d566f8206e5b957ab1493
## https://gist.github.com/bastomiadi/abf27618341fc561735adfb17e586916

## Vorbereitung:

sudo cfdisk
sudo wipefs -a /dev/sda


sudo mkfs.vfat -F32 -n EFI /dev/sda1
sudo mkfs.ext4 -L BOOT /dev/sda2
sudo cryptsetup luksFormat --type=luks2 -s=512 /dev/sda3
sudo cryptsetup luksOpen /dev/sda3 void

sudo mkfs.btrfs -L Void /dev/mapper/void
sudo BTRFS_OPTS="rw,relatime,compress=zstd,space_cache=v2,discard=async"
sudo mount -o $BTRFS_OPTS /dev/mapper/void /mnt

sudo btrfs su cr /mnt/home
sudo btrfs su cr /mnt/snapshots

sudo mkdir -p /mnt/home
sudo mount -o $BTRFS_OPTS,subvol=home /dev/mapper/void /mnt/home
sudo mkdir -p /mnt/.snapshots
sudo mount -o $BTRFS_OPTS,subvol=snapshots /dev/mapper/cryptroot /mnt/.snapshots
sudo mkdir -p /mnt/boot
sudo mount /dev/sda2 /mnt/boot
sudo mkdir -p /mnt/boot/efi
sudo mount /dev/sda1 /mnt/boot/efi

sudo mkdir -p /mnt/var
sudo btrfs su cr /mnt/var/cache
sudo btrfs su cr /mnt/var/tmp
sudo btrfs su cr /mnt/var/log
sudo mkdir -p /mnt/var/lib
sudo btrfs su cr /mnt/var/lib/flatpak


sudo mkdir -p /mnt/var/db/xbps/keys
sudo cp /var/db/xbps/keys/* /mnt/var/db/xbps/keys/

sudo xbps-install -S -R https://repo-de.voidlinux.org/current -r /mnt base-system cryptsetup nano xmirror btrfs-progs lz4

su
xchroot /mnt
chown root:root /
chmod 755 /
passwd root
nano /etc/hostname
nano /etc/locale.conf
nano /etc/default/libc-locales
nano /etc/rc.conf
EDITOR=nano visudo
   %wheel ALL=(ALL) ALL

xbps-reconfigure -f glibc-locales

xmirror -s https://repo-de.voidlinux.org/
xbps-install -S
xbps-install void-repo-nonfree
xbps-install -S

nano /etc/dracut.conf.d/override.conf
hostonly="yes"
hostonly_cmdline="no"
stdloglvl="3"
show_modules="yes"
compress="lz4"
omit_dracutmodules+=" brltty rpmversion selinux convertfs ssh-client "
  

nano /etc/fstab
  /dev/sda2 /boot	ext4	defaults,relatime	0	2
  /dev/sda1	/boot/efi	vfat	defaults,relatime	0	2

xbps-install dbus-elogind dbus-elogind-libs elogind #dbus-elogind-x11 Optional

xbps-install intel-ucode
xbps-install rtkit

xbps-install dracut-uefi gummiboot-efistub
cp /usr/lib/gummiboot/linuxx64.efi.stub /boot/efi/
nano /etc/default/dracut-uefi-hook

sudo blkid

 KERNEL_CMDLINE="loglevel=3 rd.luks.name=<LUKS root UUID>=void root=UUID=<UUID> rootflags=rw rootfstype=btrfs rd.auto=1 rd.luks.allow-discards rd.driver.pre=i915 udev.log_level=2 console=tty6 vt.global_cursor_default=0 quiet splash"


xbps-install NetworkManager iwd
mkdir -p /etc/NetworkManager/conf.d/
nano /etc/NetworkManager/conf.d/wifi_backend.conf
[device]
wifi.backend=iwd
wifi.iwd.autoconnect=yes

nano /etc/iwd/main.conf
[General]
UseDefaultInterface=true
  
xbps-reconfigure -fa

exit
umount -R /mnt
shutdown -r now



